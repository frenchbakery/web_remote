<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Servo Control</title>
  <link rel="stylesheet" href="css/rslider.css">
  <link rel="stylesheet" href="css/motors.css">
  <script src="js/motors.js"></script>
</head>
<body>
<div class="hbox">
  <button id="back" onclick="toIndex()">
    ‚Üê
  </button>
  <h1>
    Servo Control
  </h1>
</div>
<div class="slideContainer">
  <div class="slideButtonContainer">
    <div class="portSelectorBox">
      Port:
      <label for="motor0s"></label>
      <select name="motor0" id="motor0s">
        <option>0</option>
        <option>1</option>
        <option>2</option>
        <option>3</option>
      </select>
    </div>
    <div id="motor0"></div>
    <label class="valueLabel" id="label0">0</label>
    <button class="resetButton" onclick="motor0.onValueChange(0)">
      Stop
    </button>
  </div>
  <div class="slideButtonContainer">
    <div class="portSelectorBox">
      Port:
      <label for="motor1s"></label>
      <select name="motor0" id="motor1s">
        <option>0</option>
        <option>1</option>
        <option>2</option>
        <option>3</option>
      </select>
    </div>
    <div id="motor1"></div>
    <label class="valueLabel" id="label1">0</label>
    <button class="resetButton" onclick="motor1.onValueChange(0)">
      Stop
    </button>
  </div>
</div>
</body>
<script src="js/rslider.js"></script>
<script>
  const label0 = document.getElementById("label0");
  const label1 = document.getElementById("label1");

  const motor0s = document.getElementById("motor0s");
  const motor1s = document.getElementById("motor1s");

  motor0s.options[0].selected = true;
  motor1s.options[1].selected = true;

  motor0s.onValueChange = val => {currentM0 = val};
  motor1s.onValueChange = val => {currentM1 = val};

  function updateServer(motorID, velocity)
  {
    const data = {
      type: "set",
      request: "motor",
      port: parseInt(motorID),
      velocity: parseInt(velocity)
    };

    let socket = new WebSocket("ws://192.168.37.207:9999");

    socket.onopen = (_) => {
      socket.send(JSON.stringify(data));
    }

    socket.onmessage = (event) => {
      console.log("result: ", JSON.parse(event.data))
    }

  }


  const motor0 = new NoiceButton("motor0", 1024, 500, 0, 2047);
  motor0.setValueChangeCallback((value) => {
    value = Math.round(value);
    label0.innerText = value + "";
    // updateServer(currentM0, velocity);
  })

  const motor1 = new NoiceButton("motor1", 1024, 500, 0, 2047);
  motor1.setValueChangeCallback((value) => {
    value = Math.round(value);
    label1.innerText = value + "";
    // updateServer(currentM1, velocity);
  })
</script>
</html>
